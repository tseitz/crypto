//@version=4
strategy("EMA Cross Strategy", overlay=true, calc_on_every_tick=true)

// let's be responsible
longLossPerc = input(1.0, title='Long Stop Loss %', type=input.float, step=1) / 100
shortLossPerc = input(1.0, title='Short Stop Loss %', type=input.float, step=1) / 100
longStopPrice = strategy.position_avg_price * (1 - longLossPerc)
shortStopPrice = strategy.position_avg_price * (1 + shortLossPerc)

ema = ema(close, 200)

plot(ema, linewidth=1, color=color.orange)

bgcolor(color=crossunder(ema, close) ? color.green : na)
bgcolor(color=crossover(ema, close) ? color.red : na)

strategy.entry("long", long=true, when=crossunder(ema, close))
strategy.close("long", when=crossover(ema, close))
strategy.entry("short", long=false, when=crossover(ema, close))
strategy.close("short", when=crossover(ema, close))

if (strategy.position_size > 0)
    strategy.exit(id="stop buy", stop=longStopPrice)

if (strategy.position_size < 0)
    strategy.exit(id="stop sell", stop=shortStopPrice)